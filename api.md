# 🗂 Hipet Rest API Documentation


<div dir="rtl">
<h1>Booking system APIS</h1>
بخش اصلی و مهم اپلیکیشن ما در booking system قرار گرفته است که شامل ثبت نام متخصصان و کلینیک، مدیریت ویزیت و داشبورد متخصصات و کلینیک را شامل می شود.

<h2>Auth</h2>
قسمت احراز هویت و ثبت نام متخصصات و کلینیک را شامل می شود.

<h3>نکات تکمیلی</h3>

برای اینکه یک متخصص بتواند احراز هویت کند، باید یک مرحله قبل تر شماره موبایلش را وارد کرده باشد و وارد اکانت خودش شده باشد.
بعد از اینکه لاگین کرد، توکن و اطلاعات کاربر ارسال میشود که رول های کاربر هم ارسال می شود.
در قسمت رول های کاربر می توانید متوجه شوید که کاربر چه داشبورد های فعالی دارد.


<h3>check-profile-exist/<int:profile_type>/</h3>

کاربر اگر بخواهد در داشبورد متخصصات ثبت نام کند، اول چک کنید که کاربر قبلا ثبت نام نکرده باشد. دلیلی اضلی چک کردن این است که ثبت نام متخصصان تا زمانی که از سمت
ادمین ها تایید نشود، در لیست رول های کاربر اضافه نمی شود. برای همین باید با استفاده از این اندپوینت چک کنید که کاربر قبلا ثبت نام کرده است یا نه اگر
ثبت نام کرده بود به کاربر اطلاع دهید که ثبت نامش با موفقی انجام شده و باید صبر کند تا از سوی ادمین تایید شود.

<h2>Core</h2>

در این قسمت اندپوینت هایی که در هسته سیستم رزور قرار میگیرند، قرار گرفته است.

<h3>search/</h3>

با استفاده از این api لیست متخصصان و کلینیک هارا میتوانید دریافت کنید.
با استفاده از کوئری پارامتر های قرار داده شده می شود ریسپانس را فیلتر کرد که در داکیومنت swagger مشخص شده است.

<h3>detail/<int:profile_id>/</h3>

برای گرفتن جزئیات متخصصات و کلینیک، از این api استفاده می کنیم.
تنها چیزی که نیاز است در url ارسال شود، پروفایل آیدی است. هر  entity پروفایل یک فیلد به اسم profile type دارد که مشخص می کند این پروفایل از چه نوعی است.

اطلاعات زیادی در جزئیات پروفایل ارسال می شود. مواردی که نیاز به توضیح دارد را در ادامه توضیح می دهم:

<h4>user info</h4>
نام و نام خانوادکی و avatar image پروفایل.

<h4>vet</h4>
اگر profile type کلینیک باشد. اطلاعات دامپزشکی که این کلینیک را ثبت کرده، داخل این فیلد قرار می گیرد.

<h4>working_days</h4>
روز های کاری این پروفایل داخل این فیلد قرار میگیرد که یک آرایه از روز های کاری است.
هر روز کاری فیلد day دارد که نشاند دهنده این است برای کدام روز هفته هستش.

نکته مهم این است بر اساس اینکه روز های کاری پروفایل چه روز های هفته هستش باید در قسمت ویزیت آن روز هایی که کاربر کار نمیکند در کل قابل انتخاب نباشد. پس این فیلتر باید انجام شود. مثلا اگر تاریخ 2024-10-1 روز یکشنبه باشد و یکشنبه در روز های کاری پروفایل قرار نگرفته باشد، خب پس این تاریخ نباید قابل انتخاب باشد و در کل روز های یکشنبه را کاربر نتواند
انتخاب کند.

<h4>services</h4>
هر پروفایل سرویس های مشخص با قیمت مشخصی را دارد. در این فیلد ارسال می شود. موقعی که کاربر می خواهد خدمات را انتخاب کند سرویس هایی که این پروفایل دارد را نمایش داده می شود.

چند نکته بسیار مهم وجود دارد. پروفایل متخصص فقط خدماتی را دارد که در محل پت قابل انجام باشد. اما ممکن است این متخصص
در کلینیک کار کند. پس اگر در کلینیک خاصی کار کند، سرویس های آن کلینیک هم قابل انتخاب کردن است اما در روز و ساعت کاری که داخل آن کلینیک کار می کند. در ادامه به فیلد clinic هم اشاره می شود.

<h4>clinic_employees</h4>

اگر profile type از نوع کلینیک باشد، در این فیلد لیست کارکنان آن کلینیک قرار می گیرد.

فرض کنید پروفایل ما از نوع کلینیک است. در قدم اول کاربر سرویسی که میخواهد را انتخاب می کند. بعد بر اساس سرویسی که انتخاب کرده است چک می شود کدام employee این سرویس را دارد و سپس به کاربر لیست کارمندانی که این سرویس را دارد را نشان
می دهیم تا از بین آنها انتخاب کند. سپس هر کارمندی که انتخاب شد، روز های کار آن کارمند در کلینیک را بررسی میکنیم و تقویم کاری را برای دریافت ویزیت نشان می دهیم.

<h4>address</h4>

اگر profile type بجز کلینیک باشد، قسمت آدرس فقط استان و شهر را نشان می دهد. اگر کلینیک باشد،‌ آدرس بصورت کامل ارسال می شود.

نکته مهم این است که اگر کاربر ویزیت در محل پت را انتخاب کند و آدرس محل پت در استانی قرار داشته باشد که آدرس پروفایل در آن استان نیست، نمی تواند ویزیت در محل پت دریافت کند.
برای مثال کلینیک در استان تهران قرار دارد و آدرسی که کاربر وارد کرده است در استان اصفهان است. در این صورت موقعی که کاربر روی ویزیت کلیک کرد قبل اینکه وارد صفحه پرداخت شود آدرس هایی که کاربر ثبت کرده را نمایش میدهید تا از بین آنها آدرس را انتخاب کند یا یک آدرس جدید وارد کند
اگر آدرس با استان پروفایل یکی نباشد، اخطار می دهید و به مرحله بعد نمی روید.

<h4>clinics</h4>

اگر profile type بجز کلینیک باشد، این فیلد نشان می دهد که این پروفایل در چه کلینیک هایی کار می کند و ساعت کاری اش در آن کلینیک ها چه روز و ساعتی است.

در قسمت نشان دادن ویزیت ها به کاربر تمامی این موارد باید لحاظ شود تا کاربر تعامل بهتری داشته باشد.

<h4>pay_visit_just_online</h4>

اگر این فیلد true باشد. یعنی این متخصص یا کلینیک پرداخت در محل را بسته است و فقط پرداخت بصورت آنلاین را قبول می کند. پس گزینه انتخاب پرداخت در محل
برای انتخاب کاربر بسته می شود و میتوان یک پیغام نیز نمایش داد تا کاربر متوجه شود این پروفایل پرداخت حضوری را بسته است.

نکته مهم این است شاید یک متخصص دریافت هزینه ویزیت را فقط بصورت آنلاین ست کرده باشد، اما کلینیکی که در آن کار می کند
این فیلد false باشد. پس اگر آن ویزیت زمانی باشد که در آن کلینیک کار می کند. هزینه ویزیت بصورت حضوری برای کاربر قابل انتخاب کردن است.

<h4>turn_lock</h4>

اگر این فیلد true باشد، یعنی این کاربر در حال حاضر ویزیتش را بسته است و کاربران نمی توانند ویزیت دریافت کنند.

این فیلد برای clinic_employees و clinics نیز صدف می کند. اگر فیلد turn_lock یک کارمند روی true باشد یعنی آن کارمند ویزیتش بسته شده است. اگر 
یک کلینیک turn_lock آن true باشد یعنی آن کلینیک ویزیتش را بسته است.

<h4>on_site_visit</h4>

اگر این فیلد true باشد یعنی این پروفایل ویزیت در محل پت را هم انجام می دهد و کاربر 
می تواند از بین ویزیت در کلینیک و محل پت انتخاب کند.

اگر پروفایل از نوع متخصص باشد و در هیچ کلینیکی کار نکند، ویزیت در کلینیک برای کاربر قابل انتخاب کردن نیست.

<h4>unlock_visit_days</h4>

این فیلد مشخص می کند که این پروفایل تا چند روز آینده را ویزیت می دهد. مثلا اگر روی 10 بود فقط تا ده روز آینده را کاربر می تواند برای ویزیت انتخاب کند.
همچنین در کلاینت باید مشخص باشد و بیشتر از ده روز تاریخ انتخاب ویزیت نمایش داده نشود

<h2>Visit</h2>

قسمت ویزیت پیچیدگی های خاص خودش را دارد که باید با دقت در سمت کلاینت پیاده سازی شود تا به درستی کار کند.

<h3>clinics/<int:clinic_id>/<int:employee_profile_id>/<str:date_at>/</h3>

اگر پروفایل از نوع clinic باشد. برای دریافت ویزیت های یک کارمند خاص، از این اندپوینت استفاده می شود.
تاریخ با این فرمت باید ارسال شود:

2024-10-1

سال - ماه - روز

اگر کاربر لاگین کرده بود، حتما توکن کاربر ارسال شود!!

<h3><int:profile_id>/<str:date_at>/</h3>

برای گرفتن ویزیت های پروفایل های متخصص از این اندپیونت استفاده شود.

اگر کاربر لاگین کرده بود، حتما توکن کاربر ارسال شود!!

ساختار ویزیت هایی که در ریسپانس داده می شود به این شکل است:

</div>

````
## Visit Struct

{
    "start_at": "2024-10-06T07:47:00+03:30",
    "end_at": "2024-10-06T08:28:00+03:30",
    "visit_time": 41,
    "clinic_id": 91,
    "on_site_visit": true,
    "profile_id": 506,
    "profile_type": 1,
    "pay_visit_just_online": false
}
````

<div dir="rtl">
فیلد start_at و end_at تایم شروع و پایان ویزیت را نشان می دهند.
یک سری دیتا بیشتری از ویزیت نیز ارسال می شود مثل clinic_id که اگر nil نبود و مقدار داشت،‌ یعنی این ویزیت مربوط به یک کلینیک خاص که این متخصص در آن کار می کند است.

مثلا در جزئیات پروفایل متخصص مشخص شده است در چه کلینیک هایی کار می کند. وقتی clinic_id ویزیت مساوی با مثلا 2 باشد یعنی مرتبط با آن کلینیکی است که آیدی 2 دارد که
می توان اطلاعات بیشتر از کلینیک را در ریسپانس جزئیات پروفایل دریافت کرد.

فیلد on_site_visit اگر true باشد یعنی ویزیت در محل پت هم برای این ویزیت قابل انجام شدن است.

<h3>lock-visit-for-pay/</h3>

بعد از اینکه ویزیت های در دسترس را برای کاربر نشان دادیم. کاربر اگر روی ویزیت خاصی کلیک کرد، مراحل ثبت کردن
آن ویزیت شروع می شود.

در قدم اول باید آن ویزیت را برای این کاربر قفل کنیم سپس سمت درگاه پرداخت بفرستیم تا ویزیتش را انجام دهد.

دریافت ویزیت را مرحله به مرحله تا قفل کردن ویزیت مرور کنیم:

1. کاربر از بین ویزیت هایی که نمایش میدهیم یکی را انتخاب میکند
2. اگر ویزیت در محل پت را مشخص کرده باشد، به کاربر آدرس هایی که ثبت کرده است را نمایش می دهیم. اندپوینت نمایش آدرس ها در سواگر واضح است تنها نکته این است address_type را روی personal قرار بدهید
3. اگر کاربر ویزیت در محل پت را انتخاب کرده باشد ما آدرس هایش را نشان می دهیم و بعد اینکه آدرسش را انتخاب کرد یا آدرس جدید وارد کرد، چک میکنیم که استان آدرس کاربر با استان پروفایل متخصص/کلینیک یکی هست یا خیر اگر یکی نبود خطا میدهیم
4. در مرحله بعد که آدرس ویزیت مشخص شد(اگر کلینیک باشد آیدی آدرس کلینیک می شود و اگر ویزیت در محل باشد آیدی آدرس کاربر می شود) این ویزیت را برای کاربر قفل میکنیم تا دیگر کاربر ها نتوانند به این ویزیت دسترسی داشته باشند

برای قفل کردن ویزیت، به اندپوینت گفته شده، دقیقا اطلاعات ویزیت که در اندپوینت دریافت ویزیت گرفته این را ارسال میکنیم.

قفل ویزیت 15 دقیقه است و اگر در پانزده دقیقه کاربر ثبت ویزیت را نهایی نکند، دوباره آزاد می شود و دیگر کاربر ها می توانند آن ویزیت را مشاهده کنند. دلیل اینکه برای دریافت ویزیت اگر کاربر لاگین
کرده بود توکنش ارسال شود این است که اگر خودش یک ویزیت خاص را قفل کرده باشد، بتواند آن را مشاهده کند و دریافتش کند.

<h3>pay/</h3>

در اولین مرحله. چک می شود که موجودی کیف پول کاربر چقدر است. اندپیونت آن در قسمت wallet قرار داده شده است. مقدار balance نشان دهنده موجودی کیف
پول کاربر است.

اگر موجودی کیف پولش کمتر باشد، برای مثال هزینه ویزیت 500 هزار تومان است اما موجودی کیف پول کاربر 250 هزار تومان است. در این صورت
با استفاده از اندپوینت شارژ کردن کیف پول کاربر به مبلغ 250 هزار تومان درخواست می زنید.

سپس یک لینک پرداخت داده می شود و کاربر را به آن لینک ریدایرکت می کنید.

زمانی که کاربر از درگاه پرداخت برگشت و پرداختش موفقیت آمیز بود، ویزیت را با استفاده از اندپوینت pay ثبت می کنید.

برای ثبت ویزیت باید این اطلاعات را در بدنه پست ارسال کنید:
</div>

```
{
    "start_at": "2024-10-06T07:06:00+03:30",
    "end_at": "2024-10-06T07:47:00+03:30",
    "visit_time": 41,
    "clinic_id": 91,
    "on_site_visit": true,
    "profile_id": 506,
    "profile_type": 1,
    "pay_visit_just_online": false,
    "services": [
      3, 10
    ],
    "user_pet_id": 2501,
    "visit_reason": "string",
    "visit_on": 1,
    "pay_type": 1,
    "address_id": 673
}
```

<div dir="rtl">
فیلد start_at تا pay_visit_just_online بدون تغییر همان مقداری است که در لیست ویزیت های کاربر دریافت کرده اید.

در فیلد سرویس آیدی سرویس هایی که کاربر انتخاب کرده بود را ارسال می کنید.

آیدی پت کاربر را ارسال میکنید.

قبل از اینکه ویزیت قفل بشود باید لیست پت های کاربر را بگیرید و کاربر پت را انتخاب کند یا اینکه پت جدیدی وارد کند!!

فیلد visit_on مشخص میکند که کاربر ویزیت در کلینیک را انتخاب کرده است یا ویزیت در محل پت. توجه کنید برخی ویزیت ها فقط ویزیت در محل پت هستند و برخی دیگر
فقط ویزیت در کلینیک. میتوان به این شکل مشخص کرد:

اگر مقدار clinic_id خالی باشد کاربر فقط میتواند در محل پت ویزیت را مشخص کند و اگر clinic_id پر باشد
و مقدار on_site_visit مساوی با false باشد، کاربر فقط میتواند در کلینیک این ویزیت را بگیرد.

فیلد address_id هم طبق توضیجاتی که داده شد مشخص می شود
</div>
